<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Kubernetes MultiNode cluster on VirtualBox</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article">
<div id="header">
<h1>Kubernetes MultiNode cluster on VirtualBox</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_virtualbox_setup">VirtualBox setup</a></li>
<li><a href="#_vm_hardware_configuration">VM hardware configuration.</a></li>
<li><a href="#_prepare_servers">Prepare Servers</a>
<ul class="sectlevel2">
<li><a href="#_setup_network">Setup network.</a></li>
<li><a href="#_install_docker">Install docker</a></li>
</ul>
</li>
<li><a href="#_install_and_configure_kubernetes">Install and configure kubernetes.</a>
<ul class="sectlevel2">
<li><a href="#_prepare_server">Prepare server</a></li>
<li><a href="#_configure_master_vm">Configure Master VM.</a></li>
<li><a href="#_joining_worker_node_to_cluster">Joining worker node to cluster.</a></li>
<li><a href="#_install_helm_v3">Install Helm v3</a></li>
<li><a href="#_configure_kubernetes_dashboad_v2">Configure Kubernetes Dashboad (v2).</a></li>
<li><a href="#_installing_metrics_server">Installing Metrics server.</a></li>
<li><a href="#_installing_traefik_ingress_controller">Installing Traefik Ingress Controller.</a></li>
<li><a href="#_installing_metallb">Installing MetalLB.</a></li>
</ul>
</li>
<li><a href="#_validation">Validation.</a></li>
<li><a href="#_troubleshoot">Troubleshoot.</a>
<ul class="sectlevel3">
<li><a href="#_references">References</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>A step by step description of bringing up kubernetes cluster using VirtualBox 6.0 with ubuntu 18.04 server.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_virtualbox_setup"><a class="anchor" href="#_virtualbox_setup"></a>VirtualBox setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create two VMs k8s-master and k8s-worker as shown in below diagram.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    +----------------+                       +----------------+
    |                |                       |                |
    |   K8s-master   |                       |   K8s-s1       |
    |                |                       |                |
    | IF2        IF1 |                       | IF1        IF2 |
    +--+----------+--+                       +---+---------+--+
       |          |                              |         |
       |          |       Host only Network      |         |
       |          +------------------------------+         |
      NAT                  192.168.56.0/24               NAT


                          VirtualBox VM setup</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_vm_hardware_configuration"><a class="anchor" href="#_vm_hardware_configuration"></a>VM hardware configuration.</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Kubernetes master/controller node hardware requirement</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Component</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value (min)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 core</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RAM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network Adapter-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host only network</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network Adapter-2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NAT</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>kubernetes worker/slave node hardware requirement</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Component</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value (min)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 core</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RAM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2GB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network Adapter-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host only network</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network Adapter-2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NAT</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_prepare_servers"><a class="anchor" href="#_prepare_servers"></a>Prepare Servers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Execute the below step in both the VMs.</p>
</div>
<div class="sect2">
<h3 id="_setup_network"><a class="anchor" href="#_setup_network"></a>Setup network.</h3>
<div class="ulist">
<ul>
<li>
<p>Shutdown the VMs.</p>
</li>
<li>
<p>Modify VM network, with Adapter 1 for Host Only Network and Adapter 2 for NAT.</p>
</li>
<li>
<p>Enable Nested Virtualization</p>
<div class="listingblock">
<div class="content">
<pre>$ VBoxManage modifyvm &lt;vm-name&gt; --nested-hw-virt on</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example</div>
<div class="content">
<pre>$ VBoxManage modifyvm k8s-master --nested-hw-virt on
$ VBoxManage modifyvm k8s-qoekwe --nested-hw-virt on</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Nested Virtualization is supported for Intel i7 7Gen+ processors
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Start VM.</p>
</li>
<li>
<p>Execute below command and note down the interfaces (generally for Virtual box VMs network interface will start with enp0s).</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">$ sudo ifconfig -a</code></pre>
</div>
</div>
</li>
<li>
<p>Setup static network.</p>
<div class="paragraph">
<p>Open file <code>/etc/netplan/00-installer-config.yaml</code> and add below configuration.</p>
</div>
<div class="listingblock">
<div class="title"><strong>k8s-master</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">network:
 ethernets:
  enp0s3:
   addresses: [192.168.56.10/24]
   dhcp4: false
  enp0s8:
   addresses: []
   dhcp4: true
 version: 2</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>k8s-worker</strong></div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">network:
 ethernets:
  enp0s3:
   addresses: [192.168.56.12/24]
   dhcp4: false
  enp0s8:
   addresses: []
   dhcp4: true
 version: 2</code></pre>
</div>
</div>
</li>
<li>
<p>Update <code>/etc/hosts</code> such that command <code>hostname -i</code> outputs ip which is routable from other VM.</p>
<div class="listingblock">
<div class="title">example(master)</div>
<div class="content">
<pre>192.168.56.10 k8s-master
192.168.56.12 k8s-worker</pre>
</div>
</div>
<div class="listingblock">
<div class="title">example(worker)</div>
<div class="content">
<pre>192.168.56.10 k8s-master
192.168.56.12 k8s-worker</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This step is required since we&#8217;ve chosen host-only adapter and our default route is provided by NAT
network, if we choose Bridge network this step can be skipped.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Reboot VMs.</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p>Update Packages.</p>
<div class="ulist">
<ul>
<li>
<p>Update apt sources.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">$ sudo apt update</code></pre>
</div>
</div>
</li>
<li>
<p>Install packages</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">$ sudo apt upgrade</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_install_docker"><a class="anchor" href="#_install_docker"></a>Install docker</h3>
<div class="ulist">
<ul>
<li>
<p>Install utility packages</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">$ apt-get install -y \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg-agent \
    software-properties-common</code></pre>
</div>
</div>
</li>
<li>
<p>Add GPG key</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</code></pre>
</div>
</div>
</li>
<li>
<p>Add docker repository to apt sources.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">$ sudo add-apt-repository \
   "deb [arch=amd64] https://download.docker.com/linux/ubuntu \
   $(lsb_release -cs) \
   stable"</code></pre>
</div>
</div>
</li>
<li>
<p>Update apt sources and install docker</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">$ sudo apt update ; sudo apt install -y docker-ce docker-ce-cli containerd.io</code></pre>
</div>
</div>
</li>
<li>
<p>Verify docker service is started.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">$ sudo systemctl status docker</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_install_and_configure_kubernetes"><a class="anchor" href="#_install_and_configure_kubernetes"></a>Install and configure kubernetes.</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_prepare_server"><a class="anchor" href="#_prepare_server"></a>Prepare server</h3>
<div class="paragraph">
<p>Execute the below steps on both the VMs.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Letting iptables see bridged traffic</p>
<div class="listingblock">
<div class="content">
<pre>cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/98-kubernetes-cni.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Make sure that the br_netfilter module is loaded before this step. This can be done by running lsmod | grep br_netfilter.
To load it explicitly call sudo modprobe br_netfilter.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Reload configuration</p>
<div class="listingblock">
<div class="content">
<pre>sudo sysctl --system</pre>
</div>
</div>
</li>
<li>
<p>Add Kubernetes source gpg.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">$ curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -</code></pre>
</div>
</div>
</li>
<li>
<p>Next add kubernetes repository</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">$ sudo apt-add-repository "deb http://apt.kubernetes.io/ kubernetes-xenial main"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Browse <a href="http://apt.kubernetes.io/" class="bare">http://apt.kubernetes.io/</a> and search for the corresponding ubuntu version, since there was no kubernetes-bionic, installing kubernetes-xenial in my case.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Install <code>kuberenetes</code> packages</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">$ sudo apt update; sudo apt install -y kubeadm kubelet kubectl</code></pre>
</div>
</div>
</li>
<li>
<p>Prevent automatic update of pages</p>
<div class="listingblock">
<div class="content">
<pre>$ sudo apt-mark hold kubelet kubeadm kubectl</pre>
</div>
</div>
</li>
<li>
<p>Turn off swap</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">$ sudo swapoff -a</code></pre>
</div>
</div>
</li>
<li>
<p>Turn off swap permanently in <code>/etc/fstab</code> by executing belo command.</p>
<div class="listingblock">
<div class="content">
<pre>$ sudo sed -i '/swap/s/^\(.*\)$/#\1/g' /etc/fstab</pre>
</div>
</div>
</li>
<li>
<p>Add private ip to kubelet. Create file /etc/default/kubelet and following content in the file.</p>
<div class="listingblock">
<div class="content">
<pre>KUBELET_EXTRA_ARGS=--node-ip=192.168.56.10</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Change ip address as per master and worker node ips
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Configure docker <code>daemon.json</code>.</p>
<div class="listingblock">
<div class="content">
<pre>cat &lt;&lt;EOF | sudo tee /etc/docker/daemon.json
{
  "exec-opts": ["native.cgroupdriver=systemd"],
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "100m"
  },
  "storage-driver": "overlay2"
}
EOF</pre>
</div>
</div>
</li>
<li>
<p>Install ipvs, we shall be using ipvs for LB.</p>
<div class="listingblock">
<div class="content">
<pre>sudo apt install -y ipvsadm</pre>
</div>
</div>
</li>
<li>
<p>configure ipvsadm</p>
<div class="listingblock">
<div class="content">
<pre>cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/98-ipvsadm.conf
net.ipv4.ip_forward=1

net.ipv4.conf.all.arp_ignore=1
net.ipv4.conf.all.arp_announce=2
EOF</pre>
</div>
</div>
</li>
<li>
<p>update ipvsadm configuration</p>
<div class="listingblock">
<div class="content">
<pre>cat &lt;&lt;EOF | sudo tee  /etc/default/ipvsadm
# ipvsadm

# if you want to start ipvsadm on boot set this to true
AUTO="true"

# daemon method (none|master|backup)
DAEMON="master"

# use interface (eth0,eth1...)
IFACE="enp0s3"

# syncid to use
# (0 means no filtering of syncids happen, that is the default)
# SYNCID="0"
EOF</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Change the network interface accordingly
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Reload configuration</p>
<div class="listingblock">
<div class="content">
<pre>sudo sysctl --system</pre>
</div>
</div>
</li>
<li>
<p>Load modules</p>
<div class="listingblock">
<div class="content">
<pre>sudo modprobe -- ip_vs
sudo modprobe -- ip_vs_rr
sudo modprobe -- ip_vs_wrr
sudo modprobe -- ip_vs_sh
sudo modprobe -- ip_vs_sed
sudo modprobe -- ip_vs_lblc

sudo lsmod | grep -e ip_vs -e  nf_conntrack</pre>
</div>
</div>
</li>
<li>
<p>Reload configuration and restart <code>docker</code> and <code>kubelet</code> service.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>sudo systemctl daemon-reload
sudo systemctl restart docker
sudo systemctl restart kubelet
sudo systemctl restart ipvsadm</code></pre>
</div>
</div>
</li>
<li>
<p><strong>(Optional)</strong>Reboot VMs.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_configure_master_vm"><a class="anchor" href="#_configure_master_vm"></a>Configure Master VM.</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create <code>kubeadm-config.yaml</code> file that consists of cluster configuration.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt;EOF  | tee kubeadm-config.yaml
apiVersion: kubeadm.k8s.io/v1beta2
bootstrapTokens:
- groups:
  - system:bootstrappers:kubeadm:default-node-token
  ttl: 24h0m0s
  usages:
  - signing
  - authentication
kind: InitConfiguration
localAPIEndpoint:
  advertiseAddress: 192.168.56.10
  bindPort: 6443
---
apiServer:
  timeoutForControlPlane: 4m0s
apiVersion: kubeadm.k8s.io/v1beta2
certificatesDir: /etc/kubernetes/pki
clusterName: kubernetes
#controlPlaneEndpoint: 192.168.1.6:6443
controllerManager: {}
dns:
  type: CoreDNS
etcd:
  local:
    dataDir: /var/lib/etcd
imageRepository: k8s.gcr.io
kind: ClusterConfiguration
#kubernetesVersion: v1.18.0
networking:
  dnsDomain: cluster.local
  serviceSubnet: 10.96.0.0/12
  podSubnet: 10.244.0.0/16
scheduler: {}
FeatureGates:
  ServiceTopology: true
  TopologyManager: true
---
apiVersion: kubeproxy.config.k8s.io/v1alpha1
bindAddress: 0.0.0.0
ipvs:
  scheduler: "lblc"
  strictARP: true
kind: KubeProxyConfiguration
mode: "ipvs"

EOF</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If decide to change pod network, remember to change the pod network in <code>flannel.yaml</code>
while setting up pod network in below step.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can geneate the above configuration file using below command</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$  sudo kubeadm config print init-defaults  --component-configs KubeProxyConfiguration</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Bring up cluster now.</p>
<div class="listingblock">
<div class="content">
<pre>$ sudo kubeadm init --config kubeadm-config.yaml</pre>
</div>
</div>
</li>
<li>
<p>As output of above command shows to execute below command, run below command to update auth details
for <code>kubectl</code> command.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">$ mkdir -p $HOME/.kube
$ sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
$ sudo chown $(id -u):$(id -g) $HOME/.kube/config</code></pre>
</div>
</div>
</li>
<li>
<p>Note down (copy to notepad) the <code>kubeadm</code> join command which needs to be executed on worker nodes to join to the cluster.</p>
</li>
<li>
<p>Install pod network.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If you are using bridge network which has default route then you can directly install flannel using below command.
However if you had given host-only adapter IP address for API server. then skip this step and follow next steps.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">$ kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</code></pre>
</div>
</div>
</li>
<li>
<p>Download flannel.yaml</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</code></pre>
</div>
</div>
</li>
<li>
<p>Open <code>kube-flannel.yaml</code> file search for daemonset kind and add additional arugment <code>--iface=&lt;host-only-adaper-interface&gt;</code>, note there are
multiple daemonset definitions, either update all of them or execute <code>kubectl get nodes --show-labels</code> and get the arch and update corresponding
arch daemonset only.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">      containers:
      - name: kube-flannel
        image: quay.io/coreos/flannel:v0.11.0-amd64
        command:
        - /opt/bin/flanneld
        args:
        - --ip-masq
        - --kube-subnet-mgr
        - --iface=enp0s3 <i class="conum" data-value="1"></i><b>(1)</b>
        resources:
          requests:
            cpu: "100m"
            memory: "50Mi"
          limits:</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Added my host-only adapter here</td>
</tr>
</table>
</div>
</li>
<li>
<p>if you had changed pod network while executing <code>kubeadm init</code>, replace <code>10.244.0.0/16</code>
which chosen pod network above in <code>net-conf.json</code> section.</p>
</li>
<li>
<p>Now Create pod netwrok by applying updated yaml file</p>
<div class="listingblock">
<div class="content">
<pre>$ kubectl apply -f kube-flannel.yml</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Verify all necessary pods are started</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">$ kubectl get pods -A</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">output:</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">NAMESPACE     NAME                                 READY   STATUS    RESTARTS   AGE
kube-system   coredns-86c58d9df4-c68gd             1/1     Running   0          6m41s
kube-system   coredns-86c58d9df4-q5bht             1/1     Running   0          6m41s
kube-system   etcd-k8s-master                      1/1     Running   0          6m6s
kube-system   kube-apiserver-k8s-master            1/1     Running   0          5m59s
kube-system   kube-controller-manager-k8s-master   1/1     Running   0          5m56s
kube-system   kube-flannel-ds-amd64-stb29          1/1     Running   0          49s
kube-system   kube-proxy-882ms                     1/1     Running   0          6m41s
kube-system   kube-scheduler-k8s-master            1/1     Running   0          5m54s</code></pre>
</div>
</div>
</li>
<li>
<p>We can check if master node is ready or not by executing below command.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ kubectl get nodes</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_joining_worker_node_to_cluster"><a class="anchor" href="#_joining_worker_node_to_cluster"></a>Joining worker node to cluster.</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Now go to worker node and execute the join command previously saved when you were executing kubeadm on master.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">$  sudo kubeadm join 192.168.56.10:6443 --token t0j1zi.v5lojsnpjh9r0rbn \
       --discovery-token-ca-cert-hash sha256:40b1142d9002003ab5b085776b8b8cba4a41ceaafab06429c49eaedc2b2939fa</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The above command is sample, the values are dynamically generated.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Now go back to master and execute the below command, you should be able to see slave node added.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">$ kubectl get nodes</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">output:</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">NAME             STATUS   ROLES    AGE     VERSION
k8s-master       Ready    master   56m     v1.18.4
k8s-worker       Ready    &lt;none&gt;   2m49s   v1.18.4</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_install_helm_v3"><a class="anchor" href="#_install_helm_v3"></a>Install Helm v3</h3>
<div class="paragraph">
<p>Helm package manager consists of helm client [ Helm v3 deprecated need for server side component(tiller) which was running as pod on k8s]. We will install helm client on our master server itself.</p>
</div>
<div class="sect3">
<h4 id="_install_helm_client"><a class="anchor" href="#_install_helm_client"></a>Install helm client.</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install helm client using script on master server using below set of commands.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3
$ chmod 700 get_helm.sh
$ ./get_helm.sh</code></pre>
</div>
</div>
</li>
<li>
<p>Verify Helm is running</p>
<div class="listingblock">
<div class="content">
<pre>$ helm list</pre>
</div>
</div>
<div class="listingblock">
<div class="title">output</div>
<div class="content">
<pre>NAME    NAMESPACE       REVISION        UPDATED STATUS  CHART   APP VERSION</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configure_kubernetes_dashboad_v2"><a class="anchor" href="#_configure_kubernetes_dashboad_v2"></a>Configure Kubernetes Dashboad (v2).</h3>
<div class="sect3">
<h4 id="_install_dashboard"><a class="anchor" href="#_install_dashboard"></a>Install Dashboard</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add dashboard repository.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">$ helm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/</code></pre>
</div>
</div>
</li>
<li>
<p>Update dashboard repository.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">$ helm repo update</code></pre>
</div>
</div>
</li>
<li>
<p>Install dashboard.</p>
<div class="listingblock">
<div class="content">
<pre>helm install kubernetes-dashboard \
   kubernetes-dashboard/kubernetes-dashboard \
   --namespace kube-system \
   --set fullnameOverride=kubernetes-dashboard \
   --set serviceAccount.name=admin-user \
   --set metricsScraper.enabled=true \
   --set service.type=NodePort</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default dashboard is not recommanded to be accessed from outside the VM, if you are using ubuntu desktop you can run below command and
access the dashboard using proxy at url  <code><a href="http://localhost:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/" class="bare">http://localhost:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/</a></code> however we will be choosing <code>NodePort</code> to access dashboard using host vm&#8217;s IP as we set <code>service.type=NodePort</code>.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">$ kubectl proxy</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Wait till dashboard pod is running.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">$ kubectl get pods -n kube-system -w</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">output:</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">NAMESPACE     NAME                                   READY   STATUS    RESTARTS   AGE
kube-system   coredns-86c58d9df4-c68gd               1/1     Running   0          11m
kube-system   coredns-86c58d9df4-q5bht               1/1     Running   0          11m
kube-system   etcd-k8s-master                        1/1     Running   0          10m
kube-system   kube-apiserver-k8s-master              1/1     Running   0          10m
kube-system   kube-controller-manager-k8s-master     1/1     Running   0          10m
kube-system   kube-flannel-ds-amd64-stb29            1/1     Running   0          5m18s
kube-system   kube-proxy-882ms                       1/1     Running   0          11m
kube-system   kube-scheduler-k8s-master              1/1     Running   0          10m
kube-system   kubernetes-dashboard-57df4db6b-5phx2   1/1     Running   0          35s</code></pre>
</div>
</div>
</li>
<li>
<p>Execute the below command and note down the port on which dashboard can be accessed</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">$ kubectl get service --all-namespaces</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">output:</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">NAMESPACE     NAME                   TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)         AGE
default       kubernetes             ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP         21m
kube-system   kube-dns               ClusterIP   10.96.0.10       &lt;none&gt;        53/UDP,53/TCP   21m
kube-system   kubernetes-dashboard   NodePort    10.110.253.116   &lt;none&gt;        443:32608/TCP   10m</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The dashboard port is <strong>32608</strong> in my case.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Now we can access dashboard at URL. <a href="https://192.168.56.10:32608" class="bare">https://192.168.56.10:32608</a></p>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Port will be dynamically generated and port should be replaced from step 5.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Add admin-user to cluster role by editing <code>kubectl edit clusterrolebinding cluster-admin -n kube-system</code> and
add code snippet to subjects section.</p>
<div class="listingblock">
<div class="content">
<pre>- kind: ServiceAccount
  name: admin-user
  namespace: kubernetes-dashboard</pre>
</div>
</div>
</li>
<li>
<p>Generate the Bearer Token to access Dashboard</p>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">$ kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | \
      grep admin-user | \
      awk '{print $1}')</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">output:</div>
<div class="content">
<pre class="highlight nowrap"><code class="language-shell" data-lang="shell">Name:         admin-user-token-4nwz2
Namespace:    kube-system
Labels:       &lt;none&gt;
Annotations:  kubernetes.io/service-account.name: admin-user
              kubernetes.io/service-account.uid: a1e3ca50-1dab-11e9-9d52-080027aba7cb

Type:  kubernetes.io/service-account-token

Data
====
ca.crt:     1025 bytes
namespace:  11 bytes
token:      eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyLXRva2VuLTRud3oyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJhMWUzY2E1MC0xZGFiLTExZTktOWQ1Mi0wODAwMjdhYmE3Y2IiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06YWRtaW4tdXNlciJ9.YHRkrY1dPsrf1N4LU6qGqCPPl617faeBbHelJAdWXD3TvvZMYnQdMvZuWtFZjVMxXPdgXDud17eCffDXBg5bRAs1sxd7B37IbXVULrYFoMR-B0MjOa3eLx1edO_gvE6ZqpyPpdWxC0hWYI0P9cQ78oyZEZ0RDNctTus0qRpVrHpP5ZIMhfRPknV8zxxF-zGf8Xg8ni1NxUOHHB-DYO1T6gd4v65JgD2ohLS4N9rLpq_MrA7nc13R4sE6zDIgYi5V7kZYz0Zx72qAaV4oOGMDTr0FPP7q3m9SrH8uO3UOUe9tkp_ce8-7V9hJW8AbPHu3rLNBw2dOGnOk59yNe3jv5w</code></pre>
</div>
</div>
<div class="paragraph">
<p>Copy the token and paste it into token field in the URL to Dashboard and login to dashboard.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Due to security prevention UI can be accessed only via <code>FireFox</code>.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installing_metrics_server"><a class="anchor" href="#_installing_metrics_server"></a>Installing Metrics server.</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add stable repository</p>
<div class="listingblock">
<div class="content">
<pre>$ helm repo add stable https://kubernetes-charts.storage.googleapis.com</pre>
</div>
</div>
</li>
<li>
<p>Update helm repository</p>
<div class="listingblock">
<div class="content">
<pre>$ helm repo update</pre>
</div>
</div>
</li>
<li>
<p>Execute below helm command to install metrics server.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ helm install metrics-server stable/metrics-server \
     --namespace kube-system \
     --set args="{--logtostderr,--kubelet-insecure-tls,--kubelet-preferred-address-types=InternalIP,Hostname,InternalDNS,ExternalDNS,ExternalIP}"</code></pre>
</div>
</div>
</li>
<li>
<p>Wait for pod to come up after that you can execute top command to get resource usage.</p>
<div class="listingblock">
<div class="content">
<pre>$ kubectl top nodes</pre>
</div>
</div>
</li>
<li>
<p>Alternatively instead of using helm, download latest released component.yaml from metrics-server <a href="https://github.com/kubernetes-sigs/metrics-server/releases/">github release page</a> and then add following two args to metrics-server container[in args section after below secure-port=4443]. and finally install using `kubectl apply -f component.yaml'</p>
<div class="listingblock">
<div class="content">
<pre>- --kubelet-insecure-tls
- --kubelet-preferred-address-types=InternalIP,Hostname,InternalDNS,ExternalDNS,ExternalIP</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installing_traefik_ingress_controller"><a class="anchor" href="#_installing_traefik_ingress_controller"></a>Installing Traefik Ingress Controller.</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add traefik repository</p>
<div class="listingblock">
<div class="content">
<pre>$ helm repo add traefik https://containous.github.io/traefik-helm-chart</pre>
</div>
</div>
</li>
<li>
<p>Update helm repository</p>
<div class="listingblock">
<div class="content">
<pre>$ helm repo update</pre>
</div>
</div>
</li>
<li>
<p>Execute below helm command to install traefik.</p>
<div class="listingblock">
<div class="content">
<pre>$ helm install traefik traefik/traefik --namespace kube-system</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installing_metallb"><a class="anchor" href="#_installing_metallb"></a>Installing MetalLB.</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Execute following commands, This will deploy MetalLB to your cluster, under the metallb-system namespace</p>
<div class="listingblock">
<div class="content">
<pre>$ kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.9.3/manifests/namespace.yaml
$ kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.9.3/manifests/metallb.yaml
$ kubectl create secret generic -n metallb-system memberlist --from-literal=secretkey="$(openssl rand -base64 128)"</pre>
</div>
</div>
</li>
<li>
<p>Create L2 configuration into config-map file.</p>
<div class="listingblock">
<div class="content">
<pre>cat &lt;&lt;EOF | tee metallb-l2-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  namespace: metallb-system
  name: config
data:
  config: |
    address-pools:
    - name: default
      protocol: layer2
      addresses:
      - 192.168.56.240-192.168.56.250
EOF</pre>
</div>
</div>
</li>
<li>
<p>Apply the configuration</p>
<div class="listingblock">
<div class="content">
<pre>kubectl apply -f metallb-l2-config.yaml</pre>
</div>
</div>
</li>
<li>
<p>Now if you can list service and notice that <code>external ip</code> field has ip address set from above pool. This can be noticed for traefik service.</p>
<div class="listingblock">
<div class="content">
<pre>kubectl get svc -n kube-system</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_validation"><a class="anchor" href="#_validation"></a>Validation.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can deploy a sample angular application uploaded <a href="https://github.com/kprasad99/k8s-angular-example">here</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_troubleshoot"><a class="anchor" href="#_troubleshoot"></a>Troubleshoot.</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://kubernetes.io/docs/tasks/administer-cluster/dns-debugging-resolution/" class="bare">https://kubernetes.io/docs/tasks/administer-cluster/dns-debugging-resolution/</a> - DNS not resolving</p>
</div>
<div class="paragraph">
<p><a href="https://kubernetes.io/docs/setup/independent/troubleshooting-kubeadm/" class="bare">https://kubernetes.io/docs/setup/independent/troubleshooting-kubeadm/</a> - kubeadm</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/kubernetes/kubernetes/tree/master/pkg/proxy/ipvs" class="bare">https://github.com/kubernetes/kubernetes/tree/master/pkg/proxy/ipvs</a> - ipvs</p>
</div>
<div class="sect3">
<h4 id="_references"><a class="anchor" href="#_references"></a>References</h4>
<div class="paragraph">
<p><a href="https://github.com/helm/charts/tree/master/stable/traefik" class="bare">https://github.com/helm/charts/tree/master/stable/traefik</a> - traefik</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/helm/charts/tree/master/stable/nginx-ingress" class="bare">https://github.com/helm/charts/tree/master/stable/nginx-ingress</a> - nginx</p>
</div>
<div class="paragraph">
<p><a href="https://kubernetes.io/docs/concepts/services-networking/ingress/" class="bare">https://kubernetes.io/docs/concepts/services-networking/ingress/</a> - ingress controller</p>
</div>
<div class="paragraph">
<p><a href="https://metallb.universe.tf" class="bare">https://metallb.universe.tf</a> - metallb</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-07-30 16:10:02 +0530
</div>
</div>
</body>
</html>